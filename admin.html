<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Absensi Driver</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #fceabb, #f8b500);
      text-align: center;
      padding: 20px;
    }
    h2 {
      color: #d32f2f;
    }
    table {
      margin-top: 20px;
      width: 100%;
    }
    img {
      width: 100px;
    }
    .filter-date {
      margin-bottom: 15px;
    }
    .btn {
      padding: 6px 12px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      color: white;
      background-color: #4CAF50;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <img src="https://upload.wikimedia.org/wikipedia/commons/2/23/Logo_Pertamina.svg" alt="Logo Pertamina" width="100">
  <h2>Data Absensi Driver</h2>

  <div class="filter-date">
    Filter Tanggal: <input type="date" id="filterTanggal" />
    <button class="btn" onclick="loadData()">Refresh Data</button>
    <button class="btn" onclick="exportExcel()">Export Excel</button>
    <button class="btn" onclick="exportPDF()">Export PDF</button>
  </div>

  <table id="tabel" class="display">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Tanggal</th>
        <th>Jam</th> <!-- kosong atau nanti boleh dihapus -->
        <th>Lokasi</th>
        <th>Foto</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbyl4Rq2Fe5nr-6rfeOk9NQFRmjseVI9EPSrBUvpcedO1CiumKbm7KekosOhU9ky269p/exec";

    function formatTanggal(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleString("id-ID", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      });
    }

    function loadData() {
      fetch(endpoint)
        .then(res => res.json())
        .then(data => {
          const tbody = $("#tabel tbody");
          tbody.empty();
          const filterTanggal = document.getElementById("filterTanggal").value;
          let no = 1;
          data.forEach(row => {
            const tanggalFormatted = formatTanggal(row.Timestamp);
            const rowDate = tanggalFormatted.split(" ")[0]; // ambil tanggalnya saja

            if (!filterTanggal || filterTanggal.split("-").reverse().join("/") === rowDate) {
              const lokasiLink = row.lokasi ? `<a href="${row.lokasi}" target="_blank">Lihat Lokasi</a>` : "-";
              const img = row.foto ? `<img src="${row.foto}" />` : "-";
              const tr = `
                <tr>
                  <td>${no++}</td>
                  <td>${row.nama}</td>
                  <td>${tanggalFormatted}</td>
                  <td>-</td>
                  <td>${lokasiLink}</td>
                  <td>${img}</td>
                </tr>
              `;
              tbody.append(tr);
            }
          });
          $("#tabel").DataTable();
        });
    }

    function exportExcel() {
      const table = document.getElementById("tabel");
      const wb = XLSX.utils.table_to_book(table, { sheet: "Absensi" });
      XLSX.writeFile(wb, "absensi_driver.xlsx");
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.autoTable({ html: "#tabel" });
      doc.save("absensi_driver.pdf");
    }

    window.onload = loadData;
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
